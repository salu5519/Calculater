<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Calculator Vault</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg-dark: #0f1115;
            --bg-card: rgba(30, 32, 40, 0.7);
            --accent-blue: #00f2ff;
            --accent-purple: #bd00ff;
            --text-main: #ffffff;
            --text-muted: #8b9bb4;
            --glass-border: rgba(255, 255, 255, 0.1);
            --shadow-glow: 0 0 15px rgba(0, 242, 255, 0.2);
            --font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: linear-gradient(135deg, #050505 0%, #1a1a2e 100%);
            color: var(--text-main);
            font-family: var(--font-family);
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* --- Utility & Animations --- */
        .hidden { display: none !important; }
        .fade-in { animation: fadeIn 0.4s ease forwards; }
        .slide-up { animation: slideUp 0.4s cubic-bezier(0.2, 0.8, 0.2, 1); }
        .scale-in { animation: scaleIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes scaleIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        /* --- Setup Screen --- */
        #setup-screen {
            position: absolute;
            inset: 0;
            z-index: 100;
            background: var(--bg-dark);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .setup-title {
            font-size: 1.5rem;
            margin-bottom: 2rem;
            background: linear-gradient(to right, var(--accent-blue), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .pin-display {
            font-size: 2.5rem;
            letter-spacing: 0.5rem;
            margin-bottom: 2rem;
            min-height: 3rem;
            color: var(--accent-blue);
            text-shadow: 0 0 10px rgba(0, 242, 255, 0.3);
        }

        /* --- Calculator UI --- */
        #calculator-screen {
            height: 100%;
            display: flex;
            flex-direction: column;
            background: #000;
        }

        .calc-display {
            flex: 1;
            display: flex;
            align-items: flex-end;
            justify-content: flex-end;
            padding: 2rem;
            font-size: 4rem;
            font-weight: 300;
            color: #fff;
            word-break: break-all;
        }

        .calc-keypad {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            padding: 20px;
            background: rgba(255,255,255,0.02);
            border-top-left-radius: 30px;
            border-top-right-radius: 30px;
        }

        .calc-btn {
            aspect-ratio: 1;
            border-radius: 50%;
            border: none;
            background: rgba(255,255,255,0.08);
            color: #fff;
            font-size: 1.5rem;
            cursor: pointer;
            transition: transform 0.1s, background 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .calc-btn:active { transform: scale(0.9); background: rgba(255,255,255,0.15); }
        .calc-btn.operator { color: var(--accent-blue); background: rgba(0, 242, 255, 0.1); }
        .calc-btn.action { color: #ff5555; background: rgba(255, 85, 85, 0.1); }
        .calc-btn.equals {
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            color: #fff;
            box-shadow: 0 4px 15px rgba(189, 0, 255, 0.4);
        }

        /* --- Vault UI --- */
        #vault-screen {
            position: absolute;
            inset: 0;
            background: var(--bg-dark);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            z-index: 50;
        }

        /* Vault Header */
        .vault-header {
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(255,255,255,0.02);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--glass-border);
        }

        .vault-brand {
            font-weight: 700;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .vault-brand i { color: var(--accent-purple); }

        .vault-time { font-size: 0.9rem; color: var(--text-muted); }

        /* Vault Content Area */
        #vault-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            padding-bottom: 100px; /* Space for nav */
            position: relative;
        }

        /* Cards */
        .vault-card {
            background: var(--bg-card);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }

        .vault-card:active { transform: scale(0.98); }
        
        .card-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            background: rgba(255,255,255,0.05);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .c-purple { color: #d946ef; box-shadow: 0 0 10px rgba(217, 70, 239, 0.2); }
        .c-blue { color: #0ea5e9; box-shadow: 0 0 10px rgba(14, 165, 233, 0.2); }
        .c-green { color: #22c55e; box-shadow: 0 0 10px rgba(34, 197, 94, 0.2); }
        .c-red { color: #ef4444; box-shadow: 0 0 10px rgba(239, 68, 68, 0.2); }
        .c-orange { color: #f97316; box-shadow: 0 0 10px rgba(249, 115, 22, 0.2); }

        .card-info h3 { font-size: 1rem; margin-bottom: 4px; }
        .card-info p { font-size: 0.8rem; color: var(--text-muted); }

        /* Section Specifics */
        .grid-gallery {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }

        .gallery-item {
            aspect-ratio: 1;
            background: #222;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
            cursor: pointer;
        }

        .gallery-item img, .gallery-item video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .fab-add {
            position: fixed;
            bottom: 90px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--accent-blue);
            color: #000;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            box-shadow: 0 4px 20px rgba(0, 242, 255, 0.4);
            z-index: 60;
            border: none;
            cursor: pointer;
        }

        /* Bottom Nav */
        .bottom-nav {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            height: 65px;
            background: rgba(20, 20, 30, 0.9);
            backdrop-filter: blur(20px);
            border-radius: 35px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            border: 1px solid var(--glass-border);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            z-index: 100;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--text-muted);
            font-size: 1.2rem;
            gap: 4px;
            cursor: pointer;
            transition: color 0.3s;
            width: 50px;
        }

        .nav-item.active { color: var(--accent-blue); }
        .nav-item.active i { transform: translateY(-2px); }
        .nav-label { font-size: 0.6rem; font-weight: 600; }

        /* Inputs & Frames */
        .search-bar {
            width: 100%;
            padding: 12px 20px;
            border-radius: 25px;
            border: 1px solid var(--glass-border);
            background: rgba(255,255,255,0.05);
            color: #fff;
            outline: none;
            margin-bottom: 15px;
        }
        
        iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 12px;
            background: #fff;
        }

        .iframe-container {
            width: 100%;
            height: calc(100vh - 200px);
            border-radius: 12px;
            overflow: hidden;
        }

        /* Fullscreen Viewers */
        #fullscreen-viewer {
            position: fixed;
            inset: 0;
            background: #000;
            z-index: 200;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #fullscreen-viewer img, #fullscreen-viewer video {
            max-width: 100%;
            max-height: 100%;
        }
        .viewer-controls {
            position: absolute;
            bottom: 30px;
            display: flex;
            gap: 20px;
        }
        .v-btn {
            background: rgba(255,255,255,0.2);
            padding: 10px 20px;
            border-radius: 20px;
            color: #fff;
            text-decoration: none;
            cursor: pointer;
        }

    </style>
</head>
<body>

    <!-- SETUP SCREEN -->
    <div id="setup-screen" class="hidden">
        <div class="setup-title">Set Your 4-Digit PIN</div>
        <div class="pin-display" id="setup-pin-display"></div>
        <div class="calc-keypad" style="border-radius: 20px; margin-top: 20px;">
            <button class="calc-btn" onclick="setupPin(1)">1</button>
            <button class="calc-btn" onclick="setupPin(2)">2</button>
            <button class="calc-btn" onclick="setupPin(3)">3</button>
            <button class="calc-btn" onclick="setupPin(4)">4</button>
            <button class="calc-btn" onclick="setupPin(5)">5</button>
            <button class="calc-btn" onclick="setupPin(6)">6</button>
            <button class="calc-btn" onclick="setupPin(7)">7</button>
            <button class="calc-btn" onclick="setupPin(8)">8</button>
            <button class="calc-btn" onclick="setupPin(9)">9</button>
            <button class="calc-btn action" onclick="clearSetup()">C</button>
            <button class="calc-btn" onclick="setupPin(0)">0</button>
            <button class="calc-btn equals" onclick="confirmSetup()">=</button>
        </div>
    </div>

    <!-- CALCULATOR SCREEN -->
    <div id="calculator-screen">
        <div class="calc-display" id="calc-display">0</div>
        <div class="calc-keypad">
            <button class="calc-btn action" onclick="calcInput('C')">C</button>
            <button class="calc-btn operator" onclick="calcInput('%')">%</button>
            <button class="calc-btn operator" onclick="calcInput('/')">÷</button>
            <button class="calc-btn operator" onclick="calcInput('*')">×</button>
            
            <button class="calc-btn" onclick="calcInput('7')">7</button>
            <button class="calc-btn" onclick="calcInput('8')">8</button>
            <button class="calc-btn" onclick="calcInput('9')">9</button>
            <button class="calc-btn operator" onclick="calcInput('-')">−</button>
            
            <button class="calc-btn" onclick="calcInput('4')">4</button>
            <button class="calc-btn" onclick="calcInput('5')">5</button>
            <button class="calc-btn" onclick="calcInput('6')">6</button>
            <button class="calc-btn operator" onclick="calcInput('+')">+</button>
            
            <button class="calc-btn" onclick="calcInput('1')">1</button>
            <button class="calc-btn" onclick="calcInput('2')">2</button>
            <button class="calc-btn" onclick="calcInput('3')">3</button>
            <button class="calc-btn equals" style="grid-row: span 2; border-radius: 40px;" onclick="calcInput('=')">=</button>
            
            <button class="calc-btn" onclick="calcInput('0')" style="grid-column: span 2; border-radius: 40px; aspect-ratio: auto;">0</button>
            <button class="calc-btn" onclick="calcInput('.')">.</button>
        </div>
    </div>

    <!-- VAULT SCREEN -->
    <div id="vault-screen" class="hidden">
        <div class="vault-header">
            <div class="vault-brand">
                <i class="fas fa-user-secret"></i>
                <span>Vault</span>
            </div>
            <div class="vault-time" id="vault-time">12:00</div>
        </div>

        <div id="vault-content">
            <!-- Dynamic Content Injected Here -->
        </div>

        <!-- Hidden File Inputs -->
        <input type="file" id="file-input-photo" accept="image/*" class="hidden" multiple>
        <input type="file" id="file-input-video" accept="video/*" class="hidden" multiple>

        <div class="bottom-nav slide-up">
            <div class="nav-item active" onclick="navTo('home')">
                <i class="fas fa-home"></i>
                <span class="nav-label">Home</span>
            </div>
            <div class="nav-item" onclick="navTo('gallery')">
                <i class="fas fa-images"></i>
                <span class="nav-label">Photos</span>
            </div>
            <div class="nav-item" onclick="navTo('video')">
                <i class="fas fa-video"></i>
                <span class="nav-label">Video</span>
            </div>
            <div class="nav-item" onclick="navTo('browser')">
                <i class="fas fa-globe"></i>
                <span class="nav-label">Web</span>
            </div>
            <div class="nav-item" onclick="navTo('youtube')">
                <i class="fab fa-youtube"></i>
                <span class="nav-label">Tube</span>
            </div>
            <div class="nav-item" onclick="navTo('games')">
                <i class="fas fa-gamepad"></i>
                <span class="nav-label">Games</span>
            </div>
        </div>
    </div>

    <!-- FULLSCREEN VIEWER -->
    <div id="fullscreen-viewer" class="hidden">
        <div id="viewer-content"></div>
        <div class="viewer-controls">
            <div class="v-btn" onclick="closeViewer()">Close</div>
            <div class="v-btn" style="background:var(--accent-purple)" onclick="downloadCurrent()">Download</div>
            <div class="v-btn" style="background:red" onclick="deleteCurrent()">Delete</div>
        </div>
    </div>

    <script>
        /* --- STATE & STORAGE --- */
        let PIN = localStorage.getItem('VAULT_PIN');
        let currentInput = '';
        let tempSetupPin = '';
        let db;
        let currentViewerItem = null; // {id, blob, type}

        /* --- INIT --- */
        window.onload = async () => {
            initDB();
            updateClock();
            setInterval(updateClock, 1000);

            if (!PIN) {
                document.getElementById('setup-screen').classList.remove('hidden');
                document.getElementById('calculator-screen').classList.add('hidden');
            }
        };

        function updateClock() {
            const now = new Date();
            document.getElementById('vault-time').innerText = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }

        /* --- INDEXED DB --- */
        function initDB() {
            const request = indexedDB.open("VaultDB", 1);
            request.onupgradeneeded = (e) => {
                db = e.target.result;
                if (!db.objectStoreNames.contains("files")) {
                    db.createObjectStore("files", { keyPath: "id", autoIncrement: true });
                }
            };
            request.onsuccess = (e) => { db = e.target.result; };
            request.onerror = (e) => { console.error("DB Error", e); };
        }

        function saveFileToDB(file, type) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => {
                    const transaction = db.transaction(["files"], "readwrite");
                    const store = transaction.objectStore("files");
                    const item = {
                        name: file.name,
                        type: type, // 'image' or 'video'
                        blob: new Blob([reader.result], { type: file.type }),
                        date: new Date().toISOString()
                    };
                    store.add(item);
                    transaction.oncomplete = () => resolve();
                    transaction.onerror = () => reject();
                };
                reader.readAsArrayBuffer(file);
            });
        }

        function getFilesFromDB(type) {
            return new Promise((resolve) => {
                const transaction = db.transaction(["files"], "readonly");
                const store = transaction.objectStore("files");
                const request = store.getAll();
                request.onsuccess = () => {
                    const all = request.result;
                    resolve(all.filter(f => f.type === type));
                };
            });
        }

        function deleteFileFromDB(id) {
            const transaction = db.transaction(["files"], "readwrite");
            transaction.objectStore("files").delete(id);
            return new Promise(r => transaction.oncomplete = r);
        }

        /* --- SETUP FLOW --- */
        function setupPin(num) {
            if (tempSetupPin.length < 4) {
                tempSetupPin += num;
                updateSetupDisplay();
            }
        }
        function clearSetup() {
            tempSetupPin = '';
            updateSetupDisplay();
        }
        function updateSetupDisplay() {
            document.getElementById('setup-pin-display').innerText = '*'.repeat(tempSetupPin.length);
        }
        function confirmSetup() {
            if (tempSetupPin.length === 4) {
                PIN = tempSetupPin;
                localStorage.setItem('VAULT_PIN', PIN);
                document.getElementById('setup-screen').classList.add('hidden');
                document.getElementById('calculator-screen').classList.remove('hidden');
            } else {
                alert("Please enter a 4-digit PIN");
            }
        }

        /* --- CALCULATOR LOGIC --- */
        function calcInput(val) {
            const display = document.getElementById('calc-display');
            
            if (val === 'C') {
                currentInput = '';
                display.innerText = '0';
                return;
            }

            if (val === '=') {
                // CHECK PIN
                if (currentInput === PIN) {
                    unlockVault();
                    currentInput = '';
                    display.innerText = '0';
                    return;
                }
                
                // Normal Calc
                try {
                    // Safe eval alternative
                    currentInput = new Function('return ' + currentInput)().toString();
                    display.innerText = currentInput;
                } catch {
                    display.innerText = 'Error';
                    currentInput = '';
                }
                return;
            }

            if (display.innerText === '0' && val !== '.') {
                currentInput = val;
            } else {
                currentInput += val;
            }
            display.innerText = currentInput;
        }

        /* --- VAULT LOGIC --- */
        function unlockVault() {
            document.getElementById('calculator-screen').classList.add('hidden');
            document.getElementById('vault-screen').classList.remove('hidden');
            navTo('home');
        }

        /* --- NAVIGATION --- */
        function navTo(section) {
            // Update Nav UI
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            // Find icon based on section to set active (simple approximation)
            const map = {'home':0, 'gallery':1, 'video':2, 'browser':3, 'youtube':4, 'games':5};
            document.querySelectorAll('.nav-item')[map[section]].classList.add('active');

            const content = document.getElementById('vault-content');
            content.innerHTML = ''; // Clear current

            switch(section) {
                case 'home': renderHome(); break;
                case 'gallery': renderGallery(); break;
                case 'video': renderVideo(); break;
                case 'browser': renderBrowser(); break;
                case 'youtube': renderYouTube(); break;
                case 'games': renderGames(); break;
            }
        }

        /* --- RENDERERS --- */
        function renderHome() {
            const content = document.getElementById('vault-content');
            content.innerHTML = `
                <div class="vault-card fade-in" onclick="navTo('gallery')">
                    <div class="card-icon c-purple"><i class="fas fa-images"></i></div>
                    <div class="card-info"><h3>Private Gallery</h3><p>Photos hidden safely</p></div>
                </div>
                <div class="vault-card fade-in" style="animation-delay: 0.1s" onclick="navTo('video')">
                    <div class="card-icon c-blue"><i class="fas fa-video"></i></div>
                    <div class="card-info"><h3>Video Vault</h3><p>Secure movie storage</p></div>
                </div>
                <div class="vault-card fade-in" style="animation-delay: 0.2s" onclick="navTo('browser')">
                    <div class="card-icon c-green"><i class="fas fa-globe"></i></div>
                    <div class="card-info"><h3>Private Browser</h3><p>No history, no trace</p></div>
                </div>
                <div class="vault-card fade-in" style="animation-delay: 0.3s" onclick="navTo('youtube')">
                    <div class="card-icon c-red"><i class="fab fa-youtube"></i></div>
                    <div class="card-info"><h3>YouTube Player</h3><p>Watch privately</p></div>
                </div>
                <div class="vault-card fade-in" style="animation-delay: 0.4s" onclick="navTo('games')">
                    <div class="card-icon c-orange"><i class="fas fa-gamepad"></i></div>
                    <div class="card-info"><h3>Games</h3><p>Play offline</p></div>
                </div>
            `;
        }

        /* GALLERY */
        async function renderGallery() {
            const content = document.getElementById('vault-content');
            const files = await getFilesFromDB('image');
            
            let html = `<div class="grid-gallery fade-in">`;
            files.forEach(f => {
                const url = URL.createObjectURL(f.blob);
                html += `<div class="gallery-item" onclick="openViewer(${f.id}, '${url}', 'image')">
                            <img src="${url}">
                         </div>`;
            });
            html += `</div>`;
            
            html += `<button class="fab-add scale-in" onclick="document.getElementById('file-input-photo').click()">
                        <i class="fas fa-plus"></i>
                     </button>`;
            
            content.innerHTML = html;
        }

        /* VIDEO */
        async function renderVideo() {
            const content = document.getElementById('vault-content');
            const files = await getFilesFromDB('video');
            
            let html = `<div class="grid-gallery fade-in" style="grid-template-columns: 1fr 1fr;">`;
            files.forEach(f => {
                const url = URL.createObjectURL(f.blob);
                html += `<div class="gallery-item" onclick="openViewer(${f.id}, '${url}', 'video')">
                            <video src="${url}#t=0.5" preload="metadata"></video>
                            <i class="fas fa-play" style="position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); color:#fff; font-size:2rem; text-shadow:0 0 10px #000;"></i>
                         </div>`;
            });
            html += `</div>`;
            
            html += `<button class="fab-add scale-in" onclick="document.getElementById('file-input-video').click()">
                        <i class="fas fa-plus"></i>
                     </button>`;
            
            content.innerHTML = html;
        }

        /* BROWSER */
        function renderBrowser() {
            const content = document.getElementById('vault-content');
            content.innerHTML = `
                <div class="fade-in">
                    <form onsubmit="loadUrl(event)">
                        <input type="text" id="browser-url" class="search-bar" placeholder="Search or type URL...">
                    </form>
                    <div class="iframe-container">
                        <iframe id="browser-frame" src="https://cse.google.com/cse?cx=11a079372ff6946ed"></iframe>
                    </div>
                </div>
            `;
        }

        function loadUrl(e) {
            e.preventDefault();
            let query = document.getElementById('browser-url').value;
            const frame = document.getElementById('browser-frame');
            
            if (query.includes('.') && !query.includes(' ')) {
                if (!query.startsWith('http')) query = 'https://' + query;
                frame.src = query;
            } else {
                // Fallback search
                frame.src = `https://www.bing.com/search?q=${encodeURIComponent(query)}`;
            }
        }

        /* YOUTUBE */
        function renderYouTube() {
            const content = document.getElementById('vault-content');
            content.innerHTML = `
                <div class="fade-in">
                    <form onsubmit="playYoutube(event)">
                        <input type="text" id="yt-search" class="search-bar" placeholder="Search Video or Paste ID...">
                    </form>
                    <div class="iframe-container">
                        <iframe id="yt-frame" src="https://www.youtube.com/embed?listType=search&list=android%20development" allowfullscreen></iframe>
                    </div>
                </div>
            `;
        }

        function playYoutube(e) {
            e.preventDefault();
            let val = document.getElementById('yt-search').value;
            const frame = document.getElementById('yt-frame');
            
            // If it looks like an ID (11 chars)
            if (val.length === 11 && !val.includes(' ')) {
                frame.src = `https://www.youtube.com/embed/${val}`;
            } else {
                // Use listType search hack which is still supported in embeds
                frame.src = `https://www.youtube.com/embed?listType=search&list=${encodeURIComponent(val)}`;
            }
        }

        /* GAMES */
        function renderGames() {
            const content = document.getElementById('vault-content');
            const games = [
                {name: "Yeti Sensation", url: "https://gemioli.com/yetisensation/html5/gemioli/"},
                {name: "Slinguin", url: "https://gemioli.com/slinguin/html5/gemioli/"},
                {name: "The Saloon", url: "https://gemioli.com/thesaloon/html5/gemioli/"},
                {name: "Pirate Ship", url: "https://gemioli.com/thepirateship/"}
            ];

            let html = `<div class="fade-in">`;
            games.forEach(g => {
                html += `<div class="vault-card" onclick="playGame('${g.url}')">
                            <div class="card-icon c-orange"><i class="fas fa-gamepad"></i></div>
                            <div class="card-info"><h3>${g.name}</h3><p>Tap to play</p></div>
                         </div>`;
            });
            html += `</div>`;
            content.innerHTML = html;
        }

        function playGame(url) {
            const content = document.getElementById('vault-content');
            content.innerHTML = `
                <div class="scale-in" style="height:100%; display:flex; flex-direction:column;">
                    <div style="margin-bottom:10px; cursor:pointer; color:var(--accent-blue)" onclick="navTo('games')">
                        <i class="fas fa-arrow-left"></i> Back
                    </div>
                    <iframe src="${url}" style="flex:1; border-radius:12px; background:#000;"></iframe>
                </div>
            `;
        }

        /* --- VIEWER & ACTIONS --- */
        async function openViewer(id, url, type) {
            // Find blob again to support download
            const files = await getFilesFromDB(type);
            const file = files.find(f => f.id === id);
            currentViewerItem = { id: id, blob: file.blob, name: file.name, type: type };

            const wrapper = document.getElementById('fullscreen-viewer');
            const container = document.getElementById('viewer-content');
            container.innerHTML = '';
            
            if (type === 'image') {
                const img = document.createElement('img');
                img.src = url;
                container.appendChild(img);
            } else {
                const vid = document.createElement('video');
                vid.src = url;
                vid.controls = true;
                vid.autoplay = true;
                container.appendChild(vid);
            }
            wrapper.classList.remove('hidden');
        }

        function closeViewer() {
            document.getElementById('fullscreen-viewer').classList.add('hidden');
            const container = document.getElementById('viewer-content');
            container.innerHTML = ''; // Stop video
        }

        function downloadCurrent() {
            if (!currentViewerItem) return;
            const url = URL.createObjectURL(currentViewerItem.blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = currentViewerItem.name || 'vault-download';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        async function deleteCurrent() {
            if (!currentViewerItem) return;
            if (confirm("Delete this file permanently?")) {
                await deleteFileFromDB(currentViewerItem.id);
                closeViewer();
                // Refresh current view
                if (currentViewerItem.type === 'image') navTo('gallery');
                else navTo('video');
            }
        }

        /* --- EVENT LISTENERS FOR INPUTS --- */
        document.getElementById('file-input-photo').addEventListener('change', async (e) => {
            for (let file of e.target.files) {
                await saveFileToDB(file, 'image');
            }
            navTo('gallery');
        });

        document.getElementById('file-input-video').addEventListener('change', async (e) => {
            for (let file of e.target.files) {
                await saveFileToDB(file, 'video');
            }
            navTo('video');
        });

    </script>
</body>
</html>